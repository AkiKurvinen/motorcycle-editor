<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor</title>
    <link rel="stylesheet" href="editor.css">
    <link rel="stylesheet" href="switch.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
</head>
<body>
    <div id="editor">
        <div class="wrapper">
        <div class="editorheader">
        <h1>Customize your e-motorcycle</h1>
        <div><i>Dark Mode</i>
            <label class="switch">
            <input type="checkbox" id="darkmode" onclick="darkMode()">
            <span class="slider round"></span>
            </label>
            </div>
        </div>
  
        <div class="split">
            <div id="parts">
            </div>
            <div id="preview">
                <img src="img/preview/headlight.svg" alt="" id="headlight">
                <img src="img/preview/frame1.png" alt="" id="frame">
                <img src="img/preview/seat1.png" alt="" id="seat">
                <img src="img/preview/color.png" alt="" id="colorhue" style="filter: hue-rotate(90deg);">
                <img src="img/preview/specular.png" alt="" id="specular">
                <img src="img/preview/tires1.png" alt="" id="tires">
                <img src="img/preview/engine1.png" alt="" id="engine">
                <img src="img/preview/battery1.png" alt="" id="battery">
                <img src="img/preview/lamp.png" alt="" id="lamp">
            </div>
        </div>
        <div id="options" style="scroll-behavior: smooth;">
            
        </div>
        </div>
    </div>



    <script>

        
        const partsData = {
            'frame': [
                ['Carbon Fiber', 40000],
                ['Titanium', 30000],
                ['Aluminium', 20000]
                ],
            'seat': [
                ['Polished Leather', 1500],
                ['Faux Leather', 1400],
                ['PVC', 1300],
                ['Reindeer Pelt', 1200],
                ],
            'engine': [
                ['Thunder (150 HP)', 2000],
                ['Flash (50 HP)', 1400],
                ['Spark (5 HP)', 1300]
                ],
            'battery': [
                ['Li-ion (400 km*)', 10000],
                ['Li-ion (200 km*)', 6000],
                ['Lead Acid (80 km*)', 7000],
                ['AAA (2 km*)', 1000],
                ],
            'tires': [
                ['Urban', 400],
                ['All-road', 800],
                ['Off-road', 1600]
                ],
            'color': [
                ['HSL', 400],
                ],
            }
        
        let hue = 0;
        let saturation = 1;
        let lightness = 1;
        
        const formatPrice = (x) => {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }
        const init = () => {
            let partsHtml = '<ul>'
            let html = '' 

            for (const [key, value] of Object.entries(partsData)) {
                //console.log(`${key}: ${value}`);
                partsHtml += `<li id="${key}_txt"><b><a href="#${key}_option">${key}</a></b>`
                html += `<div class="option" id="${key}_option">`
                    html += `<img src="img/thumbs/${key}1.png" alt="" id="${key}_thumb">`
                    if(key=='color'){
                        html += '<img src="img/thumbs/color_specular.png" alt="" id="colorSpecular">'
                    }
                    html += `<div><h3>${key}</h3>`
                    
                    value.forEach((element, index) => {
                        if(index==0){
                            partsHtml += `<span><p>${element[0]}</p><i>${formatPrice(element[1])} €</i></span></li>`
                        }
                        let checkedVal = index==0 ? 'checked' : ''
                        if (key != 'color'){
                        html +=
                        `<input type="radio" id="${key}${index+1}" name="${key}" value="${key}${index+1}" ${checkedVal}>
                        <label for="${key}${index+1}">${element[0]}</label><br>`
                        }
     

                    });
                    if (key == 'color'){
                    html+= `
                      <input type="range" id="colorrange" name="hue" min="0" max="360"
                            oninput="updateBikeColors('h', this.value)"
                            onchange="updateBikeColors('h', this.value)" >
                      <label for="colorrange">H</label>

                      <input type="range" id="colorrange" name="saturation" min="0" max="200" value="100"
                            oninput="updateBikeColors('s', this.value)"
                            onchange="updateBikeColors('s', this.value)" >
                      <label for="colorrange">S</label>

                      <input type="range" id="colorrange" name="lightness" min="0" max="100" value="100"
                            oninput="updateBikeColors('l', this.value)"
                            onchange="updateBikeColors('l', this.value)" >
                      <label for="colorrange">L</label>
                     `
                    }
                
                html += '</div></div>'
            }
            partsHtml+= '<li><h4 id="totalAmount">Total: <span>0 €</span></h4></li></ul>'
            const baseElem = document.getElementById('options')
            baseElem.innerHTML = html
            
            const partsBaseElem = document.getElementById('parts')
            partsBaseElem.innerHTML = partsHtml
            

            changeBikeFilter()

        }
        const changeBikeFilter = () => {
            document.getElementById('colorhue').setAttribute('style', `filter: hue-rotate(${hue}deg) saturate(${saturation}) brightness(${lightness});`)
            document.getElementById('color_thumb').setAttribute('style', `filter: hue-rotate(${hue}deg) saturate(${saturation}) brightness(${lightness});`)
        }
        const updateBikeColors = (param, value) => {

            if(param == 'h'){
                 hue = value;
            }
            else if(param == 's'){
                 saturation = value/100;
            }
            else if(param == 'l'){
                 lightness = value/100;
            }
           
            changeBikeFilter()
        }


        const changeThumbnail = (partName, itemNumber) => {
            const elem = `${partName}_option`
            const thumbnailElem = document.querySelector(`#${elem}>img`)
            const source = thumbnailElem.getAttribute('src')
            thumbnailElem.setAttribute('src', `img/thumbs/${partName}${itemNumber}.png`)
        }
        const updatePrice = () => {
            let totalSum = 0
            document.querySelectorAll('#parts i').forEach(element => {
                totalSum += parseInt(element.innerHTML.replace(' ',''))
            });
        
            let price = formatPrice(totalSum)
            document.querySelector("#totalAmount span").innerHTML = `${price} €`;
        }
        const updateMotorcycle = (partName, itemNumber) => {
            const imgElem = document.getElementById(partName)
            imgElem.setAttribute('src', `img/preview/${partName}${itemNumber}.png`)  
        }
        const updatePartsList = (item, itemNumber) => {
            const elem = document.getElementById(`${item}_txt`)
            elem.querySelector('p').innerHTML = partsData[item][itemNumber-1][0]
            elem.querySelector('i').innerHTML = formatPrice(partsData[item][itemNumber-1][1]) + ' €'
        }
        const updateView = (item) => {
            const partName = item.slice(0, -1);
            const itemNumber = parseInt(item.slice(-1));
            changeThumbnail(partName, itemNumber)
            updateMotorcycle(partName, itemNumber)
            updatePartsList(partName, itemNumber)
            updatePrice()
        }

        $(document).ready(function(){
            $('input[type=radio]').click(function(){
                updateView(this.value)
            });
        });

        init()
        updatePrice()
        
    </script>

    <script>
    function darkMode() {
        var checkBox = document.getElementById("darkmode");
        var editorElem = document.getElementById("editor");
        if (checkBox.checked == true){
           editorElem.className = 'dark'
        } else {
             editorElem.className = 'light'
        }
    }
    </script>
    <script>
        const scrollContainer = document.querySelector("#options");

        scrollContainer.addEventListener("wheel", (evt) => {
            evt.preventDefault();
            document.getElementById("options").setAttribute('style', 'style="scroll-behavior: normal;"')
            scrollContainer.scrollLeft += evt.deltaY;
        });
        
        const scrolllinks = document.querySelectorAll("ul>li>b>a");
        scrolllinks.forEach(element => {
            element.addEventListener("click", (evt) => removeSmooth());

        const removeSmooth = () => {
            document.getElementById("options").setAttribute('style', 'scroll-behavior: smooth;')
        }
                        
        });

     


    </script>

</body>
</html>